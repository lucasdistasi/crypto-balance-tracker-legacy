<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TransferCryptoValidator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">crypto-balance-tracker</a> &gt; <a href="index.source.html" class="el_package">com.distasilucas.cryptobalancetracker.validation.crypto</a> &gt; <span class="el_source">TransferCryptoValidator.java</span></div><h1>TransferCryptoValidator.java</h1><pre class="source lang-java linenums">package com.distasilucas.cryptobalancetracker.validation.crypto;

import com.distasilucas.cryptobalancetracker.exception.ApiValidationException;
import com.distasilucas.cryptobalancetracker.exception.InsufficientBalanceException;
import com.distasilucas.cryptobalancetracker.model.request.crypto.TransferCryptoRequest;
import com.distasilucas.cryptobalancetracker.validation.EntityValidation;
import com.distasilucas.cryptobalancetracker.validation.QuantityValueValidator;
import lombok.RequiredArgsConstructor;
import org.apache.commons.lang3.StringUtils;
import org.springframework.stereotype.Component;

import java.math.BigDecimal;

import static com.distasilucas.cryptobalancetracker.constant.ExceptionConstants.INVALID_FEE_QUANTITY;
import static com.distasilucas.cryptobalancetracker.constant.ExceptionConstants.INVALID_PLATFORM_FORMAT;
import static com.distasilucas.cryptobalancetracker.constant.ExceptionConstants.NETWORK_FEE_HIGHER;
import static com.distasilucas.cryptobalancetracker.constant.RegexConstants.PLATFORM_NAME_REGEX_VALIDATION;

@Component
<span class="fc" id="L20">@RequiredArgsConstructor</span>
public class TransferCryptoValidator implements EntityValidation&lt;TransferCryptoRequest&gt; {

    private final QuantityValueValidator quantityValueValidator;

    @Override
    public void validate(TransferCryptoRequest transferCryptoRequest) {
<span class="fc" id="L27">        validateNetworkFee(transferCryptoRequest.getNetworkFee());</span>

<span class="fc bfc" id="L29" title="All 2 branches covered.">        if (isNetworkFeeHigherThanQuantity(transferCryptoRequest))</span>
<span class="fc" id="L30">            throw new InsufficientBalanceException(NETWORK_FEE_HIGHER);</span>

<span class="fc bfc" id="L32" title="All 2 branches covered.">        if (isInvalidPlatform(transferCryptoRequest.getToPlatform()))</span>
<span class="fc" id="L33">            throw new ApiValidationException(INVALID_PLATFORM_FORMAT);</span>

<span class="fc" id="L35">        quantityValueValidator.validateCryptoQuantity(transferCryptoRequest.getQuantityToTransfer());</span>
<span class="fc" id="L36">    }</span>

    private boolean isNetworkFeeHigherThanQuantity(TransferCryptoRequest transferCryptoRequest) {
<span class="fc bfc" id="L39" title="All 2 branches covered.">        return transferCryptoRequest.getNetworkFee().compareTo(transferCryptoRequest.getQuantityToTransfer()) &gt; 0;</span>
    }

    private boolean isInvalidPlatform(String toPlatform) {
<span class="pc bpc" id="L43" title="1 of 2 branches missed.">        return StringUtils.isEmpty(toPlatform) ||</span>
<span class="fc bfc" id="L44" title="All 2 branches covered.">                !toPlatform.matches(PLATFORM_NAME_REGEX_VALIDATION);</span>
    }

    private void validateNetworkFee(BigDecimal networkFee) {
<span class="fc" id="L48">        String[] networkFeeValue = String.valueOf(networkFee).split(&quot;\\.&quot;);</span>

<span class="fc bfc" id="L50" title="All 4 branches covered.">        if (!(networkFeeValue.length == 1 || isValidNumberWithDecimals(networkFeeValue)))</span>
<span class="fc" id="L51">            throw new ApiValidationException(INVALID_FEE_QUANTITY);</span>
<span class="fc" id="L52">    }</span>

    private boolean isValidNumberWithDecimals(String[] quantityValue) {
<span class="fc bfc" id="L55" title="All 4 branches covered.">        return quantityValue[0].length() &lt;= 16 &amp;&amp; quantityValue[1].length() &lt;= 12;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>